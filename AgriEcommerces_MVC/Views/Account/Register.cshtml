@model AgriEcommerces_MVC.Models.ViewModel.RegisterViewModel
@{
    ViewData["Title"] = "Đăng ký";
    Layout = "_Layout";

}

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            <div class="card shadow mt-5">
                <div class="card-body p-4">
                    <img src="~/images/logologin.png" alt="DL Farm Logo" class="mx-auto d-block mb-3" style="max-width: 250px;" />

                    <h3 class="card-title text-center mb-4">Đăng ký tài khoản</h3>

                    <form asp-action="Register"
                          asp-route-returnUrl="@(ViewData["ReturnUrl"] as string)"
                          method="post">

                        <div class="form-floating mb-3 text-black">
                            <input asp-for="FullName"
                                   class="form-control text-black"
                                   placeholder="Họ và tên" />
                            <label asp-for="FullName">Họ và tên</label>
                            <span asp-validation-for="FullName"
                                  class="text-danger small"></span>
                        </div>
                        <div class="form-floating mb-3 text-black">
                            <input asp-for="Email"
                                   class="form-control text-black"
                                   placeholder="name@example.com" />
                            <label asp-for="Email">Email</label>
                            <span asp-validation-for="Email"
                                  class="text-danger small"></span>
                        </div>
                        <div class="form-floating mb-4 text-black">
                            <input asp-for="PhoneNumber"
                                   class="form-control text-black"
                                   placeholder="Số điện thoại" />
                            <label asp-for="PhoneNumber">Số điện thoại</label>
                            <span asp-validation-for="PhoneNumber"
                                  class="text-danger small"></span>
                        </div>

                        <div class="form-floating mb-3 text-black">
                            <input asp-for="Password"
                                   type="password"
                                   class="form-control text-black"
                                   placeholder="Mật khẩu" />
                            <label asp-for="Password">Mật khẩu</label>

                            <button type="button" class="btn-toggle-password" id="togglePassword" aria-label="Hiện/Ẩn mật khẩu">
                                <i class="bi bi-eye-slash" id="eyeIcon"></i>
                            </button>

                            <span asp-validation-for="Password" class="text-danger small"></span>
                        </div>

                        <div class="form-floating mb-4 text-black">
                            <input asp-for="ConfirmPassword"
                                   type="password"
                                   class="form-control text-black"
                                   placeholder="Xác nhận mật khẩu" />
                            <label asp-for="ConfirmPassword">Xác nhận mật khẩu</label>

                            <button type="button" class="btn-toggle-password" id="toggleConfirmPassword" aria-label="Hiện/Ẩn mật khẩu">
                                <i class="bi bi-eye-slash" id="confirmEyeIcon"></i>
                            </button>

                            <span asp-validation-for="ConfirmPassword"
                                  class="text-danger small"></span>
                        </div>
                        <!-- Password strength indicator -->
                        <div class="mb-3">
                            <div class="progress" style="height: 5px;">
                                <div id="passwordStrength" class="progress-bar" role="progressbar" style="width: 0%"></div>
                            </div>
                            <small id="strengthText" class="text-muted"></small>
                        </div>

                        <div class="cf-turnstile mb-3"
                             data-sitekey="0x4AAAAAAB9xaHK9dVpPJWxh"
                             data-theme="light">
                        </div>

                        <button type="submit"
                                class="btn btn-primary w-100 py-2">
                            Đăng ký
                        </button>

                        <div class="text-center mt-3">
                            <p>
                                Bạn đã có tài khoản?<space></space>
                                <a asp-action="Login"
                                   class="link-primary">
                                    Đăng nhập
                                </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @await Html.PartialAsync("_Scripts")

    <script>
        document.addEventListener("DOMContentLoaded", function() {

            // Hàm trợ giúp để cài đặt nút bật/tắt mật khẩu
            function setupPasswordToggle(toggleButtonId, passwordInputId, eyeIconId) {
                const toggleButton = document.querySelector(toggleButtonId);
                // Lưu ý: asp-for="Password" sẽ sinh ra id="Password"
                const passwordInput = document.querySelector(passwordInputId);
                const eyeIcon = document.querySelector(eyeIconId);

                if (toggleButton && passwordInput && eyeIcon) {
                    toggleButton.addEventListener("click", function () {
                        // Lấy kiểu của ô input (password hoặc text)
                        const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
                        passwordInput.setAttribute("type", type);

                        // Đổi icon
                        if (type === "password") {
                            eyeIcon.classList.remove("bi-eye");
                            eyeIcon.classList.add("bi-eye-slash");
                        } else {
                            eyeIcon.classList.remove("bi-eye-slash");
                            eyeIcon.classList.add("bi-eye");
                        }
                    });
                }
            }

            // Cài đặt cho ô "Mật khẩu"
            setupPasswordToggle("#togglePassword", "#Password", "#eyeIcon");

            // Cài đặt cho ô "Xác nhận mật khẩu"
            setupPasswordToggle("#toggleConfirmPassword", "#ConfirmPassword", "#confirmEyeIcon");
        });
                // Password strength checker
        document.getElementById('Password').addEventListener('input', function() {
            const password = this.value;
            const strengthBar = document.getElementById('passwordStrength');
            const strengthText = document.getElementById('strengthText');

            let strength = 0;
            if (password.length >= 6) strength += 25;
            if (password.length >= 8) strength += 25;
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength += 25;
            if (/[0-9]/.test(password)) strength += 12;
            if (/[^a-zA-Z0-9]/.test(password)) strength += 13;

            strengthBar.style.width = strength + '%';

            if (strength < 40) {
                strengthBar.className = 'progress-bar'; // Xóa class màu
                strengthBar.style.backgroundColor = '#d9534f'; // Màu đỏ đậm hơn (hoặc 'crimson')
                strengthText.textContent = 'Yếu';
                strengthText.className = ''; // Xóa class màu
                strengthText.style.color = '#d9534f';
                strengthText.style.fontWeight = 'bold'; // In đậm
            } 
            else if (strength < 70) {
                strengthBar.className = 'progress-bar';
                strengthBar.style.backgroundColor = '#f0ad4e'; // Màu vàng đậm hơn (hoặc 'darkorange')
                strengthText.textContent = 'Trung bình';
                strengthText.className = '';
                strengthText.style.color = '#f0ad4e';
                strengthText.style.fontWeight = 'bold';
            } 
            else {
                strengthBar.className = 'progress-bar';
                strengthBar.style.backgroundColor = '#5cb85c'; // Màu xanh đậm hơn (hoặc 'green')
                strengthText.textContent = 'Mạnh';
                strengthText.className = '';
                strengthText.style.color = '#5cb85c';
                strengthText.style.fontWeight = 'bold';
            }
        });
    </script>
}

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        .text-danger {
            color: red !important;
        }

        /* --- THÊM CSS CHO NÚT MẮT --- */

        /* Cần set relative để nút con position: absolute */
        .form-floating {
            position: relative;
        }

        .btn-toggle-password {
            position: absolute;
            top: 50%; /* Căn giữa theo chiều dọc */
            right: 0.75rem; /* Cách lề phải */
            transform: translateY(-50%);
            z-index: 10; /* Nằm trên input */
            cursor: pointer;
            border: none;
            background: transparent;
            padding: 0;
            line-height: 1;
            color: #6c757d; /* Màu xám mờ */
        }

        /* Thêm padding bên phải cho ô input để chữ không bị icon đè lên */
        .form-floating > .form-control {
            padding-right: 3rem; /* Tăng padding để vừa icon */
        }
    </style>
}