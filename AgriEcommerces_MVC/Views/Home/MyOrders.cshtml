@model List<AgriEcommerces_MVC.Models.order>
@{
    ViewData["Title"] = "Đơn hàng của tôi";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container py-5">
    <h3 class="mb-4"><i class="fas fa-shopping-bag text-primary"></i> @ViewData["Title"]</h3>

    @* --- THÔNG BÁO --- *@
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show shadow-sm">
            <i class="fas fa-check-circle me-2"></i> @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show shadow-sm">
            <i class="fas fa-exclamation-circle me-2"></i> @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (!Model.Any())
    {
        <div class="text-center py-5 bg-light rounded-3">
            <i class="fas fa-box-open fa-4x text-muted mb-3"></i>
            <h5 class="text-muted">Bạn chưa có đơn hàng nào</h5>
            <a asp-controller="Home" asp-action="Index" class="btn btn-primary mt-3 px-4">
                <i class="fas fa-shopping-cart me-2"></i> Mua sắm ngay
            </a>
        </div>
    }
    else
    {
        <ul class="nav nav-tabs nav-fill mb-4" id="orderTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active fw-bold" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab">
                    Tất cả
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link fw-bold" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab">
                    Chờ xử lý
                    <span class="badge bg-warning text-dark ms-1">@Model.Count(o => o.status == "Pending")</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link fw-bold" id="shipping-tab" data-bs-toggle="tab" data-bs-target="#shipping" type="button" role="tab">
                    Đang vận chuyển
                    <span class="badge bg-info text-dark ms-1">@Model.Count(o => o.status == "Shipped" || o.status == "Processing")</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link fw-bold" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed" type="button" role="tab">
                    Đã hoàn thành
                    <span class="badge bg-success text-dark ms-1">@Model.Count(o => o.status == "Delivered")</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link fw-bold" id="cancelled-tab" data-bs-toggle="tab" data-bs-target="#cancelled" type="button" role="tab">
                    Đã hủy
                    <span class="badge bg-danger text-dark ms-1">@Model.Count(o => o.status == "Cancelled")</span>
                </button>
            </li>
        </ul>

        <div class="tab-content" id="orderTabsContent">

            @* --- TAB: TẤT CẢ --- *@
            <div class="tab-pane fade show active" id="all" role="tabpanel">
                @await Html.PartialAsync("_OrderTablePartial", Model)
            </div>

            @* --- TAB: CHỜ XỬ LÝ (Pending + Paid) --- *@
            <div class="tab-pane fade" id="pending" role="tabpanel">
                @{
                    var pendingOrders = Model.Where(o => o.status == "Pending" || o.status == "Paid").ToList();
                }
                @if (pendingOrders.Any())
                {
                    @await Html.PartialAsync("_OrderTablePartial", pendingOrders)
                }
                else
                {
                    <div class="text-center py-5 text-muted">Không có đơn hàng đang chờ xử lý.</div>
                }
            </div>

            @* --- TAB: ĐANG VẬN CHUYỂN (Processing + Shipped) --- *@
            <div class="tab-pane fade" id="shipping" role="tabpanel">
                @{
                    var shippingOrders = Model.Where(o => o.status == "Processing" || o.status == "Shipped").ToList();
                }
                @if (shippingOrders.Any())
                {
                    @await Html.PartialAsync("_OrderTablePartial", shippingOrders)
                }
                else
                {
                    <div class="text-center py-5 text-muted">Không có đơn hàng đang vận chuyển.</div>
                }
            </div>

            @* --- TAB: ĐÃ HOÀN THÀNH (Delivered) --- *@
            <div class="tab-pane fade" id="completed" role="tabpanel">
                @{
                    var completedOrders = Model.Where(o => o.status == "Delivered").ToList();
                }
                @if (completedOrders.Any())
                {
                    @await Html.PartialAsync("_OrderTablePartial", completedOrders)
                }
                else
                {
                    <div class="text-center py-5 text-muted">Chưa có đơn hàng nào hoàn thành.</div>
                }
            </div>

            @* --- TAB: ĐÃ HỦY (Cancelled) --- *@
            <div class="tab-pane fade" id="cancelled" role="tabpanel">
                @{
                    var cancelledOrders = Model.Where(o => o.status == "Cancelled").ToList();
                }
                @if (cancelledOrders.Any())
                {
                    @await Html.PartialAsync("_OrderTablePartial", cancelledOrders)
                }
                else
                {
                    <div class="text-center py-5 text-muted">Không có đơn hàng đã hủy.</div>
                }
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        setTimeout(function() {
            $('.alert').fadeOut('slow');
        }, 5000);
    </script>
}