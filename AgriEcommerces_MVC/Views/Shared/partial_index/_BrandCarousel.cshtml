@model IEnumerable<AgriEcommerces_MVC.Models.product>

<section class="py-5 overflow-hidden">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="section-header d-flex flex-wrap justify-content-between mb-5">
                    <h2 class="section-title">Sản Phẩm Được Đánh Giá Cao</h2>
                    <div class="d-flex align-items-center">
                        <a asp-controller="Products" asp-action="Index" class="btn-link text-decoration-none">Xem Tất Cả Sản Phẩm →</a>
                        <div class="swiper-buttons">
                            <button class="swiper-prev brand-carousel-prev btn btn-yellow">❮</button>
                            <button class="swiper-next brand-carousel-next btn btn-yellow">❯</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="brand-carousel swiper">
                    <div class="swiper-wrapper">
                        @* Lặp qua từng sản phẩm có ít nhất một đánh giá 5 sao *@
                        @foreach (var p in Model.Where(p => p.reviews.Any(r => r.rating == 5)))
                        {
                            <div class="swiper-slide">
                                <div class="card mb-3 p-3 rounded-4 shadow border-0 text-center h-100">
                                    <div class="image-holder position-relative mb-3" style="height: 280px; overflow: hidden;">
                                        @* Lấy ảnh đầu tiên, nếu không có thì dùng ảnh mặc định *@
                                        @{
                                            var imgUrl = p.productimages.FirstOrDefault()?.imageurl;
                                            var thumb = !string.IsNullOrEmpty(imgUrl)
                                            ? Url.Content(imgUrl)
                                            : Url.Content("~/images/default-product.png");
                                        }
                                        <img src="@thumb"
                                             class="img-fluid rounded position-absolute top-50 start-50 translate-middle"
                                             alt="@p.productname"
                                             style="width: 100%; height: 100%; object-fit: cover;" />
                                    </div>
                                    <div class="card-body py-0 d-flex align-items-center justify-content-center flex-grow-1">
                                        @* Chỉ hiển thị tên sản phẩm *@
                                        <h5 class="card-title mb-0 text-truncate">@p.productname</h5>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    /* CSS bổ sung để đảm bảo tất cả card có cùng chiều cao */
    .brand-carousel .swiper-slide {
        height: auto;
    }

    .brand-carousel .card {
        min-height: 380px;
        display: flex;
        flex-direction: column;
    }

    .brand-carousel .image-holder {
        flex-shrink: 0;
    }

    .brand-carousel .card-body {
        flex-grow: 1;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .brand-carousel .card-title {
        font-size: 1rem;
        line-height: 1.2;
        max-height: 2.4em;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }
</style>